# Feature Specification: リリースZIP展開後のナビゲーション制御

**Feature Branch**: `005-nav-control`
**Created**: 2026-02-08
**Status**: Draft
**Input**: User description: "リリースZIP展開後のナビゲーション制御。購入者・管理者レイアウトのナビゲーションリンクがハードコードされており、未実装ドメインへのリンクがエラー画面に遷移する。本番実装されたドメインのみナビゲーションに表示されるようにする。"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 購入者画面のナビゲーション制御 (Priority: P1)

リリースZIPを展開して本番開発を開始した開発チームが、最初のドメイン（例：商品カタログ）を実装した。購入者がサイトにアクセスすると、実装済みの「商品一覧」メニューのみが表示される。未実装の「カート」「注文履歴」はナビゲーションに表示されず、ユーザーがエラー画面に遷遇することがない。

**Why this priority**: 購入者向け画面はエンドユーザーが直接触れる部分であり、未実装リンクの表示はユーザー体験を大きく損なう。最優先で対応すべき。

**Independent Test**: 購入者レイアウトのナビゲーションに実装済みドメインのリンクのみが表示され、未実装ドメインのリンクが非表示であることで検証できる。

**Acceptance Scenarios**:

1. **Given** 商品カタログドメインのみが実装されている, **When** 購入者がサイトにアクセスする, **Then** ナビゲーションに「商品一覧」のみが表示される
2. **Given** 商品カタログとカートドメインが実装されている, **When** 購入者がサイトにアクセスする, **Then** ナビゲーションに「商品一覧」と「カート」が表示される
3. **Given** すべてのドメインが実装されている, **When** 購入者がサイトにアクセスする, **Then** ナビゲーションに「商品一覧」「カート」「注文履歴」がすべて表示される

---

### User Story 2 - 管理者画面のナビゲーション制御 (Priority: P2)

管理者が管理画面にアクセスすると、実装済みドメインの管理メニューのみがサイドバーに表示される。ダッシュボードは常に表示されるが、「商品管理」「注文管理」は対応するドメインが実装されている場合のみ表示される。

**Why this priority**: 管理者画面も未実装リンクがあるとエラーになるが、利用者が開発チーム内に限定されるため P2 とする。

**Independent Test**: 管理者レイアウトのサイドバーに実装済みドメインの管理メニューのみが表示されることで検証できる。

**Acceptance Scenarios**:

1. **Given** どのドメインも実装されていない, **When** 管理者が管理画面にアクセスする, **Then** サイドバーに「ダッシュボード」のみが表示される
2. **Given** 商品カタログドメインが実装されている, **When** 管理者が管理画面にアクセスする, **Then** サイドバーに「ダッシュボード」と「商品管理」が表示される
3. **Given** すべてのドメインが実装されている, **When** 管理者が管理画面にアクセスする, **Then** サイドバーに「ダッシュボード」「商品管理」「注文管理」がすべて表示される

---

### User Story 3 - サンプル実装時の全メニュー表示 (Priority: P3)

アーキテクチャリポジトリ（サンプル実装が存在する状態）では、すべてのナビゲーションリンクが従来どおり表示される。サンプル実装はすべてのドメインを含むため、全メニューが表示される。

**Why this priority**: アーキテクチャリポジトリでの動作は既存の振る舞いの維持であり、新規実装ではないため P3 とする。

**Independent Test**: サンプル実装が存在する状態で全メニューが表示されることで検証できる。

**Acceptance Scenarios**:

1. **Given** サンプル実装（全ドメイン）が存在する, **When** 購入者がサイトにアクセスする, **Then** ナビゲーションに「商品一覧」「カート」「注文履歴」がすべて表示される
2. **Given** サンプル実装（全ドメイン）が存在する, **When** 管理者が管理画面にアクセスする, **Then** サイドバーに「ダッシュボード」「商品管理」「注文管理」がすべて表示される

---

### User Story 4 - ドキュメント更新 (Priority: P4)

ナビゲーション制御の仕組みに合わせて、関連ドキュメントを更新する。新規ドメイン実装時にナビゲーションへの追加方法が分かるようにする。

**Why this priority**: ドキュメントは機能実装後に整備すべきであり、最後に対応する。

**Independent Test**: ドキュメントにナビゲーション追加手順が記載されていることで検証できる。

**Acceptance Scenarios**:

1. **Given** ナビゲーション制御が実装されている, **When** 開発者がドキュメントを参照する, **Then** 新規ドメイン実装時のナビゲーション追加手順が記載されている
2. **Given** ナビゲーション制御が実装されている, **When** 開発者が入力例ドキュメントを参照する, **Then** ナビゲーションリンク追加を含む実装手順が記載されている

---

### Edge Cases

- ドメインが1つも実装されていない場合、購入者画面のナビゲーションはどう表示するか？ → ナビゲーションリンクなし（ヘッダーのサイト名とログインのみ表示）
- フッターリンク（プライバシーポリシー、利用規約）は制御対象か？ → 対象外。フッターリンクは静的ページへのリンクであり、常に表示する
- ダッシュボードページ内のクイックリンク（「新規商品登録」「注文一覧へ」等）も制御対象か？ → 対象外。ダッシュボードページの内容は各ドメイン実装時に個別対応する

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: 購入者レイアウトのナビゲーションには、実装済みドメインに対応するリンクのみが表示されること
- **FR-002**: 管理者レイアウトのサイドバーには、ダッシュボードに加え、実装済みドメインに対応する管理メニューのみが表示されること
- **FR-003**: サンプル実装が存在する状態では、すべてのナビゲーションリンクが表示されること（既存の振る舞いを維持）
- **FR-004**: ドメインの実装有無の判定は、アプリケーション起動時やビルド時ではなく、ナビゲーション定義の記述内容で静的に決定されること
- **FR-005**: 新規ドメインを実装した際のナビゲーションへの追加は、該当レイアウトファイルの `navLinks` 配列に1行追加するだけで完結すること
- **FR-006**: フッターリンク（プライバシーポリシー、利用規約）はナビゲーション制御の対象外であり、常に表示されること
- **FR-007**: 関連ドキュメント（入力例、README等）にナビゲーション追加手順が記載されていること

### Key Entities

- **ナビゲーションリンク**: 表示ラベルとリンク先URLの組。購入者用と管理者用でそれぞれ定義される
- **ドメイン実装状態**: 各ドメイン（商品カタログ、カート、注文）が実装済みかどうかの状態。ナビゲーションリンクの定義有無で表現される

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: ZIP展開直後（ドメイン未実装）の状態で、購入者画面にドメイン固有のナビゲーションリンクが0個表示されること
- **SC-002**: ZIP展開直後の状態で、管理者画面にダッシュボードのみ（1個）のナビゲーションリンクが表示されること
- **SC-003**: サンプル実装が存在する状態で、購入者画面に3個、管理者画面に3個のナビゲーションリンクが表示されること（既存と同数）
- **SC-004**: 新規ドメインのナビゲーション追加が、レイアウトファイルの1行追加で完結すること

## Assumptions

- 購入者用ナビゲーションリンクの対象ドメインは商品カタログ（`/catalog`）、カート（`/cart`）、注文（`/orders`）の3つ
- 管理者用ナビゲーションリンクの対象ドメインは商品管理（`/admin/products`）、注文管理（`/admin/orders`）の2つ（ダッシュボード `/admin` は常に表示）
- ナビゲーション制御はレイアウトファイル内の `navLinks` 定義を変更する方式とし、外部設定ファイルやランタイム検出は使用しない
- ZIP展開直後は `navLinks` が空配列（またはダッシュボードのみ）となり、ドメイン実装時に開発者が該当リンクを追加する運用とする
