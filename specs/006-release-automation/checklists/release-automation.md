# Release Automation Checklist: GitHub リリース自動化

**Purpose**: リリース自動化の仕様品質を検証する（アーキテクチャリポジトリ固有機能）
**Created**: 2026-02-08
**Feature**: [spec.md](../spec.md)
**Scope**: アーキテクチャリポジトリのみ。リリース ZIP 展開後の開発リポジトリには影響しない。

**Note**: This checklist is generated by the `/speckit.checklist` command based on feature context and requirements.

## Requirement Completeness

- [x] CHK001 リリースコマンド実行の前提条件（main ブランチ、リモートプッシュ権限）は FR として明文化されているか？ → FR-003 として main ブランチ以外での実行を警告・中断する要件を追加済み [Gap, Edge Cases §5]
- [x] CHK002 タグプッシュ後のワークフロー失敗時（ZIP 作成失敗、gh release create 失敗等）のリカバリ手順は仕様に定義されているか？ → Edge Cases に ZIP 作成・Release 作成失敗時の対処（タグ削除→再実行 or 手動作成）を追加済み [Gap, Exception Flow]
- [x] CHK003 バージョンインクリメント後の `package.json` のフォーマット保持要件（インデント、末尾改行等）は定義されているか？ → FR-010 と US2 にフォーマット保持要件（インデント 2 スペース、末尾改行）を明記済み [Gap]
- [x] CHK004 リリースコマンドのエラーメッセージの内容・形式は FR-002 で具体的に規定されているか？ → FR-002 にエラーメッセージの具体的な文面を明記済み [Clarity, Spec §FR-002]
- [x] CHK005 ワークフローが `contents: write` 以外の GitHub Actions 権限を必要としないことは仕様に明記されているか？ → FR-015 として最小権限の原則（`contents: write` のみ）を追加済み [Gap, Security]

## Requirement Clarity

- [x] CHK006 FR-007 の除外パターンは具体的に列挙されているか？ → FR-007 で除外対象のディレクトリ・ファイルを明示的に列挙済み [Clarity, Spec §FR-007]
- [x] CHK007 FR-009 の「パッチバージョンを自動的にインクリメント」は PATCH のみに限定されることが明確か？ → FR-010 で「PATCH バージョンのみ」と明記し、「MAJOR・MINOR は変更しない」を追加済み [Clarity, Spec §FR-010]
- [x] CHK008 FR-010 の「CI を再トリガーしないよう制御」の具体的なメカニズムは仕様レベルで規定すべきか？ → FR-011 で `[skip ci]` を仕様レベルで明記済み。CI スキップの仕組みは GitHub Actions の標準機能であり仕様に含めて適切 [Clarity, Spec §FR-011]
- [x] CHK009 SC-001 の「人手を介さず完了する」の範囲は明確か？ → SC-001 を「リリースコマンド実行後、タグ作成・プッシュ以降のすべてのステップが人手を介さず完了」と明確化済み [Ambiguity, Spec §SC-001]

## Requirement Consistency

- [x] CHK010 User Story 1 の Acceptance Scenario 1 では `v0.1.0` を例としているが、現在の `package.json` は `1.0.4` である。 → 全 Acceptance Scenario の例示バージョンを `1.0.4`/`1.0.5` に統一済み [Consistency, Spec §US-1]
- [x] CHK011 除外パターンの定義は一元的か？ → FR-007 で除外パターンを明示的に列挙。ローカル ZIP 作成機能はスコープ外のため除外パターンの二重管理は不要 [Consistency, Spec §FR-007]
- [x] CHK012 Assumptions に「リリースは main ブランチからのみ行う」とあるが、Edge Cases では「未定義」としていた。 → FR-003 として main ブランチ以外での実行を警告・中断する FR を追加し、Edge Cases も整合させた [Conflict, Assumptions vs Edge Cases §5]

## Acceptance Criteria Quality

- [x] CHK013 SC-002 の「パッチバージョンインクリメント」は客観的に検証可能か？ → SC-002 で `package.json` の PATCH バージョンが自動インクリメントされることを明記済み [Measurability, Spec §SC-002]
- [x] CHK014 SC-003 の「CI が再トリガーされない」は検証方法が仕様で定義されているか？ → SC-003 に「CI ワークフローの実行履歴に新たな実行が記録されないこと」と検証方法を明記済み [Measurability, Spec §SC-003]
- [x] CHK015 SC-001 の「人手を介さず完了する」のタイムアウト要件は定義されているか？ → GitHub Actions ワークフローのデフォルトタイムアウト（6 時間）に従う。ワークフロー固有のタイムアウト設定は実装詳細として plan に委ねる [Measurability, Spec §SC-001]

## Scenario Coverage

- [x] CHK016 リリースコマンド実行時にローカルに未コミットの変更がある場合の動作要件は定義されているか？ → Edge Cases に「ローカルの未コミット変更やリモートとの分岐状態は、タグ作成・プッシュの成否に影響しない（git の標準動作に従う）」を追加済み [Coverage, Gap]
- [x] CHK017 リリースコマンド実行時にリモートとローカルの main が分岐している場合の動作要件は定義されているか？ → CHK016 と同じ Edge Cases 項目でカバー済み [Coverage, Gap]
- [x] CHK018 複数の開発者が同時にリリースコマンドを実行した場合の排他制御要件は定義されているか？ → Edge Cases に「2 人目はタグの重複エラーで中断される（排他制御は git タグの一意性に依存する）」を追加済み [Coverage, Gap]
- [x] CHK019 ワークフローのバージョンインクリメント・プッシュが失敗した場合の中間状態の対処要件は定義されているか？ → Edge Cases に「GitHub Release は作成済みだが package.json は未更新の中間状態」の対処手順を追加済み [Coverage, Exception Flow]

## スコープ境界（アーキテクチャリポジトリ固有）

- [x] CHK020 リリース ZIP にリリース自動化関連ファイル（`release.yml`, `create-release-tag.ps1`）が含まれないことは FR-007 で十分にカバーされているか？ → FR-007 で `scripts/` ディレクトリ全体の除外による暗黙的な除外を明記済み [Completeness, Spec §FR-007]
- [x] CHK021 ZIP 展開後の開発リポジトリで `pnpm release` コマンドが存在しても無害であることは仕様で考慮されているか？ → Scope Boundaries に「ZIP 展開後の開発リポジトリへの影響」セクションを追加し、無害性を明記済み [Coverage, Gap]
- [x] CHK022 `scripts/` ディレクトリ全体が ZIP から除外されるため、`create-release-tag.ps1` は自然に除外される。この暗黙の除外は仕様で明記されているか？ → FR-007 に明記済み [Clarity, Spec §FR-007]

## Dependencies & Assumptions

- [x] CHK023 GitHub Actions の `gh` CLI がランナーにプリインストールされている前提は Assumptions セクションに記載されているか？ → Assumptions に追加済み [Assumption, Gap]
- [x] CHK024 `github.token` の権限スコープが `contents: write` で十分であることは検証済みの前提としてドキュメントされているか？ → Assumptions に追加済み [Assumption, Gap]
- [x] CHK025 Node.js のバージョン要件（CI ランナーと `package.json` の `engines` フィールドの整合性）は仕様に含まれているか？ → Assumptions に `engines` フィールド（`>=20.0.0`）との整合性を追加済み [Dependency, Gap]

## Notes

- 全 25 項目完了。アーキテクチャリポジトリ固有のスコープ制約を反映
- spec.md を更新して全チェックリスト項目を解消
- 主な仕様変更: FR-003（main ブランチチェック）, FR-014（最小権限）追加、Edge Cases の大幅拡充、Assumptions の補完、ZIP 展開後の影響セクション追加
- US3（ローカル ZIP 作成機能の整合性維持）はスコープ外に変更。FR-013（旧）、SC-002/SC-005（旧）を削除し、FR/SC を再番号付け
