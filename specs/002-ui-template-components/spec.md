# 機能仕様書: UIテンプレートコンポーネントの拡充

**フィーチャーブランチ**: `002-ui-template-components`
**作成日**: 2026-02-07
**ステータス**: ドラフト
**入力**: speckit-trainingリポジトリのdomains実装分析に基づくUIテンプレートコンポーネントの拡充

## ユーザーシナリオとテスト *(必須)*

### ユーザーストーリー 1 - 開発者がページネーション付き一覧を素早く実装する (優先度: P1)

開発者として、商品一覧・注文一覧・管理テーブルなど、ページネーション付きの一覧画面を実装する際に、共通のPaginationコンポーネントを使いたい。現状3箇所でコピー＆ペーストされているページネーションUIを統一し、一貫した操作体験を提供したい。

**なぜこの優先度か**: ページネーションは3ドメイン（ProductList, OrderList, AdminProductTable）で重複しており、最も高い重複度を持つ。一覧表示はECサイトの基本UIであり、統一することで開発効率とUXの一貫性が大きく向上する。

**独立テスト**: Paginationコンポーネント単体でレンダリングし、ページ遷移・表示件数・無効状態が正しく機能することを確認する。

**受け入れシナリオ**:

1. **Given** Paginationコンポーネントが存在する状態で, **When** 開発者がpage=1, total=50, limit=10を指定する, **Then** 「全50件中 1〜10件を表示」と前へ/次へボタンが表示される
2. **Given** 1ページ目を表示している状態で, **When** 「前へ」ボタンを確認する, **Then** ボタンが無効化されている
3. **Given** 最終ページを表示している状態で, **When** 「次へ」ボタンを確認する, **Then** ボタンが無効化されている
4. **Given** 中間ページを表示している状態で, **When** 「次へ」ボタンを押す, **Then** onPageChangeコールバックが次ページ番号で呼ばれる
5. **Given** 総件数が0件の状態で, **When** コンポーネントを表示する, **Then** ページネーションUIは非表示になる

---

### ユーザーストーリー 2 - 開発者が価格・日時を統一フォーマットで表示する (優先度: P1)

開発者として、価格や日時の表示に共通のフォーマット関数を使いたい。現状、価格フォーマットは6箇所、日時フォーマットは2箇所でそれぞれ同じロジックが重複している。統一ユーティリティを使うことで、フォーマット変更時に一箇所の修正で済むようにしたい。

**なぜこの優先度か**: 6箇所の重複は最大の重複数であり、フォーマットの不一致はユーザー体験に直接影響する。ユーティリティ関数は他のコンポーネントの前提となるため、早期に整備すべきである。

**独立テスト**: formatPrice関数に各種金額を渡し、期待通りのフォーマット文字列を返すことを確認する。formatDateTime関数に日時を渡し、日本語ロケールの文字列を返すことを確認する。

**受け入れシナリオ**:

1. **Given** formatPrice関数が存在する状態で, **When** 1000を渡す, **Then** 「¥1,000」が返される
2. **Given** formatPrice関数が存在する状態で, **When** 0を渡す, **Then** 「無料」が返される
3. **Given** formatPrice関数が存在する状態で, **When** 15800を渡す, **Then** 「¥15,800」が返される
4. **Given** formatDateTime関数が存在する状態で, **When** 日時オブジェクトを渡す, **Then** 「2026年2月7日 14:30」のような日本語フォーマットが返される

---

### ユーザーストーリー 3 - 開発者が画像プレースホルダーを統一的に扱う (優先度: P2)

開発者として、商品画像がない場合のプレースホルダー表示を統一したい。現状ProductCard、ProductDetail、CartItemの3箇所で同じSVGアイコンによるフォールバック処理が重複している。

**なぜこの優先度か**: 画像プレースホルダーは3箇所で重複しており、商品表示に直結する視覚的要素である。統一することでデザインの一貫性が保たれる。

**独立テスト**: ImagePlaceholderコンポーネントにsrc有り/無しで表示し、画像またはプレースホルダーが正しく表示されることを確認する。

**受け入れシナリオ**:

1. **Given** ImagePlaceholderにsrcが指定された状態で, **When** レンダリングする, **Then** 指定された画像が表示される
2. **Given** ImagePlaceholderにsrcが未指定の状態で, **When** レンダリングする, **Then** SVGアイコンのプレースホルダーが表示される
3. **Given** ImagePlaceholderにaltが指定された状態で, **When** レンダリングする, **Then** 画像に適切なalt属性が設定される
4. **Given** ImagePlaceholderにsizeが指定された状態で, **When** レンダリングする, **Then** 指定サイズでコンポーネントが表示される

---

### ユーザーストーリー 4 - 開発者がステータスバッジを柔軟に表示する (優先度: P2)

開発者として、注文ステータスや商品ステータスなど、状態を色付きバッジで表示したい。ステータスの種類・色・ラベルをカスタマイズ可能な汎用コンポーネントとして提供し、ドメインをまたいで再利用できるようにしたい。

**なぜこの優先度か**: ステータスバッジは注文管理で2箇所、今後の拡張（出荷ステータス、支払いステータス等）でも需要が高い。

**独立テスト**: StatusBadgeコンポーネントに各種ステータスを渡し、対応する色とラベルが表示されることを確認する。

**受け入れシナリオ**:

1. **Given** StatusBadgeにステータスと色マッピングを指定した状態で, **When** レンダリングする, **Then** 対応する色のバッジにラベルが表示される
2. **Given** 未定義のステータスを渡した状態で, **When** レンダリングする, **Then** デフォルトのスタイルで値がそのまま表示される

---

### ユーザーストーリー 5 - 開発者が検索機能付き一覧を実装する (優先度: P3)

開発者として、商品検索のようなキーワード検索UIを素早く実装したい。Enterキーでの検索実行、クリアボタン、プレースホルダーテキストを備えた共通のSearchBarコンポーネントを使いたい。

**なぜこの優先度か**: 検索はカタログドメインで使用されており、今後ユーザー検索や注文検索などでも必要になる汎用的なUIパターンである。

**独立テスト**: SearchBarコンポーネントでテキスト入力・Enter押下・クリアの各操作が正しく機能することを確認する。

**受け入れシナリオ**:

1. **Given** SearchBarが表示された状態で, **When** テキストを入力してEnterを押す, **Then** onSearchコールバックが入力テキストで呼ばれる
2. **Given** テキストが入力された状態で, **When** クリアボタンを押す, **Then** 入力が空になりonSearchが空文字列で呼ばれる
3. **Given** SearchBarが表示された状態で, **When** 何も入力せずにEnterを押す, **Then** onSearchが空文字列で呼ばれる

---

### ユーザーストーリー 6 - 開発者が数量選択UIを実装する (優先度: P3)

開発者として、カート内商品の数量変更のような数量選択UIを素早く実装したい。+-ボタンによるステッパーUIで、最小値・最大値（在庫数）の制約を設定できる共通コンポーネントを使いたい。

**なぜこの優先度か**: 数量選択はカートドメイン固有に見えるが、在庫管理や個数指定など、ECサイト全般で汎用的に使えるパターンである。

**独立テスト**: QuantitySelectorコンポーネントで増減操作と境界値の動作を確認する。

**受け入れシナリオ**:

1. **Given** QuantitySelectorにvalue=3, min=1, max=10を指定した状態で, **When** +ボタンを押す, **Then** onChangeが4で呼ばれる
2. **Given** QuantitySelectorにvalue=1, min=1を指定した状態で, **When** -ボタンを確認する, **Then** ボタンが無効化されている
3. **Given** QuantitySelectorにvalue=10, max=10を指定した状態で, **When** +ボタンを確認する, **Then** ボタンが無効化されている
4. **Given** QuantitySelectorにdisabled=trueを指定した状態で, **When** レンダリングする, **Then** すべてのコントロールが無効化されている

---

### エッジケース

- Paginationにtotal=0を渡した場合、コンポーネント自体が非表示になる
- formatPriceに負の値を渡した場合、マイナス記号付きで表示される
- formatDateTimeに無効な日時を渡した場合、エラーをスローせずフォールバック表示する
- ImagePlaceholderに不正なURLを渡した場合、プレースホルダーにフォールバックする
- StatusBadgeにstatusColorsに存在しないステータスを渡した場合、デフォルトスタイルで表示する
- QuantitySelectorにmin > maxを渡した場合、コンポーネントが無効化される
- SearchBarに極端に長い文字列を入力した場合、適切にトリミングされる

## 要件 *(必須)*

### 機能要件

#### コンポーネント共通

- **FR-001**: すべての新規コンポーネントは、既存テンプレート（Loading, Error, Empty等）と同じコーディングパターンに従わなければならない
- **FR-002**: すべての新規コンポーネントは、data-testid属性を持ち、テスト可能でなければならない
- **FR-003**: すべての新規コンポーネントは、適切なARIAアクセシビリティ属性を持たなければならない
- **FR-004**: すべての新規コンポーネントは、プロジェクトのカラーパレット（base-50, base-100, base-900, accent）に準拠しなければならない

#### Pagination

- **FR-010**: Paginationは、現在のページ位置を「全N件中 M〜L件を表示」の形式で表示しなければならない
- **FR-011**: Paginationは、前へ/次へのナビゲーションボタンを提供しなければならない
- **FR-012**: Paginationは、最初のページでは「前へ」ボタンを無効化しなければならない
- **FR-013**: Paginationは、最後のページでは「次へ」ボタンを無効化しなければならない
- **FR-014**: Paginationは、総件数が0またはページ数が1以下の場合は非表示になるべきである

#### フォーマットユーティリティ

- **FR-020**: formatPriceは、数値を「¥」記号付きのカンマ区切り形式にフォーマットしなければならない
- **FR-021**: formatPriceは、0円を「無料」と表示しなければならない
- **FR-022**: formatDateTimeは、日時を日本語ロケール（ja-JP）の形式にフォーマットしなければならない
- **FR-023**: formatDateTimeは、年・月・日・時・分を含むフォーマットを提供しなければならない

#### ImagePlaceholder

- **FR-030**: ImagePlaceholderは、画像URLがある場合はimg要素で画像を表示しなければならない
- **FR-031**: ImagePlaceholderは、画像URLがない場合はSVGアイコンのプレースホルダーを表示しなければならない
- **FR-032**: ImagePlaceholderは、alt属性を必須パラメータとして受け取らなければならない
- **FR-033**: ImagePlaceholderは、sm/md/lgのサイズバリアントを提供すべきである

#### StatusBadge

- **FR-040**: StatusBadgeは、ステータス値に応じた色（背景色・文字色）でバッジを表示しなければならない
- **FR-041**: StatusBadgeは、色マッピングとラベルマッピングをプロパティで受け取り、ドメインに依存しない汎用性を持たなければならない
- **FR-042**: StatusBadgeは、未定義のステータスに対してデフォルトスタイルを適用しなければならない

#### SearchBar

- **FR-050**: SearchBarは、テキスト入力フィールドと検索ボタンを提供しなければならない
- **FR-051**: SearchBarは、Enterキー押下で検索を実行しなければならない
- **FR-052**: SearchBarは、入力値がある場合にクリアボタンを表示しなければならない
- **FR-053**: SearchBarは、プレースホルダーテキストをカスタマイズ可能でなければならない

#### QuantitySelector

- **FR-060**: QuantitySelectorは、+/-ボタンと数値表示を提供しなければならない
- **FR-061**: QuantitySelectorは、最小値に達した場合に-ボタンを無効化しなければならない
- **FR-062**: QuantitySelectorは、最大値に達した場合に+ボタンを無効化しなければならない
- **FR-063**: QuantitySelectorは、disabled状態をサポートしなければならない

#### ドキュメント

- **FR-070**: DESIGN_GUIDE.mdを更新し、すべての新規コンポーネントの使用例を記載しなければならない
- **FR-071**: 各コンポーネントのエクスポート用index.tsファイルを提供しなければならない

### 主要エンティティ

- **PaginationInfo**: ページネーション状態を表す。ページ番号、1ページあたりの件数、総件数、総ページ数を持つ
- **StatusMapping**: ステータスの色・ラベル対応表を表す。ステータスキーに対する背景色クラス・文字色クラス・表示ラベルを持つ

## 成功基準 *(必須)*

### 測定可能な成果

- **SC-001**: 新規コンポーネントを使用することで、一覧画面のページネーション実装が5行以内のコードで完了する
- **SC-002**: 価格・日時フォーマットが全画面で統一され、フォーマット変更が1箇所の修正で反映される
- **SC-003**: すべての新規コンポーネントの単体テストがGiven-When-Then形式で作成され、パスする
- **SC-004**: テストカバレッジ80%以上を維持する
- **SC-005**: すべての新規コンポーネントがキーボード操作可能で、適切なARIA属性を持つ
- **SC-006**: 既存のE2Eテスト（25件）がすべてパスし、リグレッションが発生しない
- **SC-007**: DESIGN_GUIDE.mdに全新規コンポーネントの使用例が記載されている

## 前提条件

- 本機能はec-site-archアーキテクチャ基盤（001-ec-arch-foundation）の上に構築する
- speckit-trainingリポジトリのdomains実装を参考実装として参照する
- 既存のテンプレートパターン（JSDocコメント、Tailwind CSSスタイル、テスト構造）を踏襲する
- 新規コンポーネントは `src/templates/ui/components/` 配下の適切なサブディレクトリに配置する
- フォーマットユーティリティは `src/templates/ui/utils/format.ts` に配置する
